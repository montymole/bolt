function Bolt(t,o,e){this.obj=t,this.view=o,this.el=e,this.autorefresh=!0;for(var i in t)this.screw(i);this.refresh()}function Vow(t){this.obj=t,this.oaths={},this.oathsTotal=0,this.oathsToFill=0,this.oathsFilled=0}function testCall1(t){t("Right away")}function testCall2(t){setTimeout(function(){t("a new value from promise getter "+Math.random())},1e3)}function testCall3(t){setTimeout(function(){t("dont forget my random promise:"+Math.random())},1500)}function boltPromiseTest(){stuffVow.promise("something",testCall1),stuffVow.promise("more",testCall3),stuffVow.yield(function(){console.log(stuff),anotherTest()})}function anotherTest(){stuffVow.promise("something",testCall2),stuffVow.yield(function(){console.log("it should be active still?"),thirdTest()})}function thirdTest(){stuffVow.unPromise("more"),stuffVow.yield(function(){console.log("unless im told to"),stuff.more="Dont change",boltPromiseTest()})}function init(){boltPromiseTest()}var lt=function(t,o,e,i){e=o.length,i="";for(var s=0;e>s;s++)i+=v[t](o[s]);return i},t=function(t,o){return function(e,i){return t.replace(/#{([^}]*)}/g,function(t,s){return Function("x","with(x)return "+s).call(e,i||o||{})})}},$=function(t,o){return t=t.match(/^(\W)?(.*)/),(o||document)["getElement"+(t[1]?"#"==t[1]?"ById":"sByClassName":"sByTagName")](t[2])},$A=function(t,o,e){for(;o.length;)e=o.shift(),t[e]=$("#"+e)},m=function(t,o,e){for(o=document,e=o.createElement("p"),e.innerHTML=t,t=o.createDocumentFragment();o=e.firstChild;)t.appendChild(o);return t},j=function(t){for(t=0;4>t;t++)try{return t?new ActiveXObject([,"Msxml2","Msxml3","Microsoft"][t]+".XMLHTTP"):new XMLHttpRequest}catch(o){}},tpl={error:'<div class="error"><b>#{this.code}</b> : #{this.message}</div>',stuffView:"<h1>Got something: #{this.something}</h1><p>#{this.more}</p>"};Bolt.prototype.screw=function(t){this.__defineSetter__(t,function(o){this.obj[t]=o,this.autorefresh&&this.refresh()}),this.__defineGetter__(t,function(){return this.obj[t]})},Bolt.prototype.populate=function(t,o){for(o in t)void 0===this[o]&&this.screw(o),this[o]=t[o]},Bolt.prototype.renderer=function(t,o,e){t={};for(e in this.obj)o=this.obj[e],t[e]=o.renderer?o.renderer():o;return this.view(t)},Bolt.prototype.refresh=function(t){t=$(this.el),t&&(t.innerHTML=this.renderer())},Vow.prototype.promise=function(t,o){this.oaths[t]&&this.unPromise(t),this.oaths[t]={property:t,getter:o},this.oathsTotal++},Vow.prototype.unPromise=function(t){delete this.oaths[t],this.oathsTotal--},Vow.prototype.get=function(t){var o=this;t.getter(function(e){o.obj[t.property]=e,o.oathsFilled++,o.oathsFilled==o.oathsToFill&&o.callback(o.obj)})},Vow.prototype.yield=function(t){this.callback=t,this.oathsFilled=0,this.oathsToFill=this.oathsTotal;for(var o in this.oaths)this.get(this.oaths[o])};var v={};for(var k in tpl)v[k]=t(tpl[k]);var stuff={something:"initial value",more:"not yet"},stuffBolt=new Bolt(stuff,v.stuffView,"#app"),stuffVow=new Vow(stuffBolt);document.addEventListener("DOMContentLoaded",init,!1);